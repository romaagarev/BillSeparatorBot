# Запуск бота в Docker

## Быстрый старт

1. Убедитесь, что у вас есть `.env` файл с настройками:
```bash
cp .env.example .env
```

2. Отредактируйте `.env` файл, добавив ваш токен бота

3. Запустите бот:
```bash
sudo docker-compose up -d
```

## Команды управления

Запуск бота:
```bash
sudo docker-compose up -d
```

Остановка бота:
```bash
sudo docker-compose down
```

Просмотр логов:
```bash
sudo docker-compose logs -f
```

Просмотр последних 100 строк логов:
```bash
sudo docker-compose logs --tail=100
```

Перезапуск бота:
```bash
sudo docker-compose restart
```

Пересборка образа после изменений кода:
```bash
sudo docker-compose down
sudo docker-compose up --build -d
```

Проверка статуса контейнера:
```bash
sudo docker ps | grep bill_separator
```

## Особенности реализации

### Автоматический перезапуск
Бот настроен на автоматический перезапуск при сетевых ошибках:
- При потере соединения с Telegram API бот автоматически переподключится
- Задержка между попытками: 5, 10, 20, 40, 60 секунд (экспоненциальный рост)
- Контейнер не упадет при временных проблемах с сетью

### Сетевые настройки
- `network_mode: host` - использует сеть хоста для лучшей совместимости
- DNS серверы Google (8.8.8.8, 8.8.4.4) для надежного разрешения имен

### Volumes
- `./data:/app/data` - база данных SQLite сохраняется на хосте
- `./bot/log.txt:/app/bot/log.txt` - логи доступны на хосте

## Структура

- `Dockerfile` - конфигурация Docker образа
- `docker-compose.yml` - конфигурация сервисов
- `.dockerignore` - файлы, исключаемые из образа
- `data/` - директория с базой данных (монтируется как volume)
- `bot/log.txt` - файл логов (монтируется как volume)

## Требования

- Docker
- Docker Compose
- Доступ к api.telegram.org (для работы бота)

## Устранение неполадок

Если бот не запускается:

1. Проверьте логи:
```bash
sudo docker-compose logs --tail=100
```

2. Проверьте, что контейнер запущен:
```bash
sudo docker ps -a | grep bill_separator
```

3. Проверьте настройки в `.env` файле

4. Убедитесь, что токен бота корректный

5. Проверьте доступность api.telegram.org:
```bash
ping api.telegram.org
```

Если есть проблемы с сетью, бот будет автоматически переподключаться.